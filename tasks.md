# ูุธุงู ู ูุดฺฉูุงุช ูพุฑูฺู ูุฑูุดุงุฑ

## โ ูุดฺฉูุงุช ุฑูุน ุดุฏู

### 1. ูุดฺฉู ุชููู ฺฉุงุฑ ุชุญูู (Analysis Job) - ุจูุจูุฏ ุงูุชู ุจุง Action Scheduler โ
- **ูุดฺฉู ุงููู**: ฺฉุงุฑ ุชุญูู ูพุณ ุงุฒ ุฑูุฑุด ุตูุญู ุง ุจุณุชู ูุฑูุฑฺฏุฑ ูุชููู ูโุดุฏ
- **ุนูุช**: ุงุณุชูุงุฏู ุงุฒ WordPress Cron ฺฉู ููุท ุจุง ุจุงุฒุฏุฏ ุตูุญู ุงุฌุฑุง ูโุดูุฏ ู ูุงุจุณุชฺฏ ุจู ุจุงุฒ ุจูุฏู ูุฑูุฑฺฏุฑ
- **ุฑุงูโุญู ููุง**: ุงุณุชูุงุฏู ุงุฒ **Action Scheduler** (ฺฉุชุงุจุฎุงูู ุฏุงุฎู ููฺฉุงูุฑุณ)
  - ุงุฌุงุฏ ุณุฑูุณ `ActionSchedulerJobManager` ุฏุฑ `src/Modules/AIAgent/Services/ActionSchedulerJobManager.php`
  - ูุฑ ุขุชู (ูุญุตูู/ูุดุชุฑ) ุจู ุตูุฑุช ฺฉ action ุฌุฏุงฺฏุงูู ุฏุฑ ุตู ูุฑุงุฑ ูโฺฏุฑุฏ
  - ูพุฑุฏุงุฒุด ุฏุฑ ูพุณโุฒููู ุจุฏูู ูุงุฒ ุจู ุจุงุฒ ุจูุฏู ูุฑูุฑฺฏุฑ
  - ูพุดุชุจุงู ุงุฒ retry ุฎูุฏฺฉุงุฑ ุฏุฑ ุตูุฑุช ุฎุทุง
  - ูุงุจูุช ูุบู ฺฉุงุฑ ุฏุฑ ูุฑ ูุญุธู
  - ุณุงุฒฺฏุงุฑ ุจุง ุชูุงู ูุงุณุชโูุง (ุจุฏูู ูุงุฒ ุจู shell commands)
  - ูุงุจู ูุดุงูุฏู ุฏุฑ `/wp-admin/admin.php?page=action-scheduler`
- **ูุดฺฉู ุซุงููู**: ุฎุทุง "No callbacks registered for aiagent_process_single_item"
  - **ุนูุช**: ููฺฉโูุง ุฏุฑ constructor ุณุฑูุณ ุซุจุช ูโุดุฏูุฏ ฺฉู ุฎู ุฏุฑ ุจูุฏ
  - **ุฑุงูโุญู**: ุซุจุช ููฺฉโูุง ุฏุฑ `AIAgentModule::boot()` ูุจู ุงุฒ resolve ุดุฏู ุณุฑูุณโูุง
  - ูุชุฏ ุฌุฏุฏ `registerActionSchedulerHooks()` ุฏุฑ `AIAgentModule` ุงุถุงูู ุดุฏ
- **ูุงูโูุง ุชุบุฑ ุงูุชู**:
  - `src/Modules/AIAgent/Services/ActionSchedulerJobManager.php` (ุฌุฏุฏ - ุญุฐู registerHooks ุงุฒ constructor)
  - `src/Modules/AIAgent/AIAgentModule.php` (ุซุจุช ุณุฑูุณ ุฌุฏุฏ + ุซุจุช ุฒูุฏููฺฏุงู ููฺฉโูุง)
  - `src/Controllers/AIAgentController.php` (ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุฌุฏุฏ)
  - `assets/js/ai-agent-admin.js` (ุญุฐู ุญููู ูพุฑุฏุงุฒุดุ ููุท polling ุจุฑุง ููุงุด)

### 2. ุฌุฏูู `aiagent_context` - ุงุณุชูุงุฏู ุจุฑุง ูพุฑุงููพุชโูุง ู ูุงูุจโูุง โ
- **ูุถุนุช**: ุฌุฏูู ูุนุงู ู ุฏุฑ ุญุงู ุงุณุชูุงุฏู
- **ฺฉุงุฑุจุฑุฏ**: 
  - ุฐุฎุฑู ูพุฑุงููพุชโูุง ุณุณุชู ุจุฑุง ุชุญูู ูุญุตููุงุช ู ูุดุชุฑุงู
  - ุฐุฎุฑู ูุงูุจโูุง ุงูู ู ูพุงูฺฉ
  - ูพุดุชุจุงู ุงุฒ import/export
  - ูุงุจูุช reset ุจู ููุงุฏุฑ ูพุดโูุฑุถ
- **ุณุฑูุณ**: `ContextManager` ุฏุฑ `src/Modules/AIAgent/Services/ContextManager.php`

### 3. ุฌุฏูู `aiagent_scheduled` ุญุฐู ุดุฏู - ููุงุฌุฑุช ุจู Action Scheduler โ
- **ูุดฺฉู ูุจู**: ุฌุฏูู ุณูุงุฑุด ุจุฑุง ูุธุงู ุฒูุงูโุจูุฏ ุดุฏู ฺฉู ูุงุฒ ุจู cron job ุฏุงุดุช
- **ุฑุงูโุญู**: ููุงุฌุฑุช ฺฉุงูู ุจู **WooCommerce Action Scheduler**
  - ุญุฐู ุฌุฏูู `aiagent_scheduled` ุงุฒ migrations
  - ุญุฐู `$scheduledTable` ุงุฒ `DatabaseService`
  - ุจุฑูุฒุฑุณุงู `AnalysisJobManager` ุจุฑุง ุงุณุชูุงุฏู ููุท ุงุฒ `wp_options`
  - ุงุฌุงุฏ `ScheduledTaskService` ุจุฑุง ูุฏุฑุช ูุธุงู ุจุง Action Scheduler
  - ููฺฉโูุง ุฌุฏุฏ:
    - `aiagent_scheduled_price_change`: ุชุบุฑุงุช ููุช ุฒูุงูโุจูุฏ ุดุฏู
    - `aiagent_scheduled_followup`: ูพฺฏุฑโูุง ุฒูุงูโุจูุฏ ุดุฏู
    - `aiagent_scheduled_campaign`: ฺฉููพูโูุง ุฒูุงูโุจูุฏ ุดุฏู
    - `aiagent_scheduled_inventory_check`: ุจุฑุฑุณ ููุฌูุฏ
- **ูุงูโูุง ุชุบุฑ ุงูุชู**:
  - `src/Modules/AIAgent/Database/Migrations.php` (ุญุฐู createScheduledTable)
  - `src/Modules/AIAgent/Services/DatabaseService.php` (ุญุฐู scheduledTable)
  - `src/Modules/AIAgent/Services/AnalysisJobManager.php` (ุญุฐู ูุงุจุณุชฺฏ ุจู ุฌุฏูู)
  - `src/Modules/AIAgent/Services/ScheduledTaskService.php` (ุงุณุชูุงุฏู ุงุฒ Action Scheduler)

### 4. ุญุฐู ูุฑุญูู ุชุฃุฏ ุงูุฏุงูุงุช โ
- **ูุดฺฉู**: ฺฉุงุฑุจุฑ ุจุงุฏ ุงุจุชุฏุง ุงูุฏุงู ุฑุง ุชุฃุฏ ู ุณูพุณ ุงุฌุฑุง ูโฺฉุฑุฏ ฺฉู redundant ุจูุฏ
- **ุฑุงูโุญู**: 
  - ููู ุงูุฏุงูุงุช ุจุง `status = 'pending'` ู `requires_approval = 0` ุงุฌุงุฏ ูโุดููุฏ
  - ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ูุณุชููุงู ูุฑ ุงูุฏุงู pending ุฑุง ุงุฌุฑุง ฺฉูุฏ
  - `approveAction()` ุงฺฉููู ูุณุชููุงู ุงูุฏุงู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
  - `approveAllActions()` ููู ุงูุฏุงูุงุช pending ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
  - ุชูุธู auto-execute ุงูุฏุงูุงุช pending ุจุง ุงูููุช ุจุงูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ

### 5. ุฑุงูููุง ูุนุงูโุณุงุฒ SMS โ
- **ุฏุฑุฎูุงุณุช**: ุชูุถุญ ูุญูู ูุนุงูโุณุงุฒ ุงุฑุณุงู ูพุงูฺฉ ุจุฑุง ฺฉุงุฑุจุฑุงู
- **ุฑุงูโุญู**: 
  - ุงุถุงูู ฺฉุฑุฏู ุจุงฺฉุณ ุฑุงูููุง ุฏุฑ ุชุจ ุชูุธูุงุช ุงูุฏุงูุงุช
  - ุชูุถุญ ููุชุฑ `aiagent_send_sms` ุจู ูุงุฑุณ
  - ููููู ฺฉุฏ ุจุฑุง ูพุงุฏูโุณุงุฒ ุจุง ุณุฑูุณโูุง ูพุงูฺฉ ุงุฑุงู
- **ูุงู**: `views/admin/partials/aiagent-tab.view.php`

### 6. ุฑฺฉูุฑุฏูุง ุฎูุงุตู ุชุญูู (run) ุฏุฑ ุฌุฏูู analysis โ
- **ูุดฺฉู**: ุฑฺฉูุฑุฏูุง ุจุง `entity_type = 'run'` ู `entity_id = 0` ุฏุฑ ุฌุฏูู `aiagent_analysis` ุฐุฎุฑู ูโุดุฏูุฏ
- **ุชูุถุญ**: ุงู ุฑฺฉูุฑุฏูุง ุฎูุงุตู ูุฑ batch ุชุญูู ูุณุชูุฏ
- **ุฑุงูโุญู**: ุจุฑูุฒุฑุณุงู ุชูุงู ูุชุฏูุง DatabaseService ุจุฑุง exclude ฺฉุฑุฏู run records

### 7. ุชุญูู ุชฺฉ ูุญุตูู/ูุดุชุฑ (Dry Run) โ
- **ุฏุฑุฎูุงุณุช**: ุงูฺฉุงู ุชุญูู ุณุฑุน ฺฉ ูุญุตูู ุง ูุดุชุฑ ุงุฒ ูุณุช ุขูโูุง ุจุฏูู ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ
- **ุฑุงูโุญู**: ุงุถุงูู ฺฉุฑุฏู ููฺฉ "ุชุญูู ููุดููุฏ" ุจู ุฑุฏู ูุญุตููุงุช ู ูุดุชุฑุงู

### 8. ูุงุจูุช Skip ูุญุตููุงุช/ูุดุชุฑุงู ุงุฎุฑุงู ุชุญูู ุดุฏู โ
- **ุฏุฑุฎูุงุณุช**: ุฌููฺฏุฑ ุงุฒ ุชุญูู ูุฌุฏุฏ ููุฌูุฏุชโูุง ฺฉู ุงุฎุฑุงู ุชุญูู ุดุฏูโุงูุฏ
- **ุฑุงูโุญู**: ุชูุธู ุฌุฏุฏ `analysis_skip_analyzed_days`

---

## ๐ก ุจูุจูุฏูุง ูพุดููุงุฏ (ุงูููุช ูุชูุณุท)

### 1. ฺฉูพุงุฑฺูโุณุงุฒ ContextManager ุจุง Analyzers
- **ูุถุนุช**: ุณุฑูุณ ุงุฌุงุฏ ุดุฏู ุงูุง ูููุฒ ุฏุฑ ProductAnalyzer ู CustomerAnalyzer ุงุณุชูุงุฏู ูุดุฏู
- **ูพุดููุงุฏ**: ุงุณุชูุงุฏู ุงุฒ `ContextManager::buildSystemPrompt()` ุฏุฑ analyzers

### 2. ุงูุฒูุฏู UI ุจุฑุง ูุฏุฑุช ูุธุงู ุฒูุงูโุจูุฏ ุดุฏู
- **ูุถุนุช**: ุณุฑูุณ backend ุขูุงุฏู ุงุณุช (Action Scheduler)
- **ูพุดููุงุฏ**: ุตูุญู ูุฏุฑุช ูุธุงู ุง ููฺฉ ุจู `/wp-admin/admin.php?page=action-scheduler`

### 3. ุงูุฒูุฏู UI ุจุฑุง ูุฏุฑุช Context/Prompts
- **ูุถุนุช**: ุณุฑูุณ backend ุขูุงุฏู ุงุณุช
- **ูพุดููุงุฏ**: ุตูุญู ูุฑุงุด ูพุฑุงููพุชโูุง ุณุณุชู

---

## ๐ ุงุฏุฏุงุดุชโูุง ูู

### ุณุฑูุณโูุง ุงุตู:
1. **ActionSchedulerJobManager** - ูุฏุฑุช ฺฉุงุฑูุง ุชุญูู ุจุง Action Scheduler
2. **ScheduledTaskService** - ูุฏุฑุช ูุธุงู ุฒูุงูโุจูุฏ ุดุฏู ุจุง Action Scheduler
3. **ContextManager** - ูุฏุฑุช ูพุฑุงููพุชโูุง ู ูุงูุจโูุง

### ุฌุฏุงูู ุฏุชุงุจุณ:
- `aiagent_analysis`: ูุชุงุฌ ุชุญูู ูุญุตููุงุช ู ูุดุชุฑุงู
- `aiagent_actions`: ุงูุฏุงูุงุช ูพุดููุงุฏ ู ุงุฌุฑุง ุดุฏู
- `aiagent_context`: ูพุฑุงููพุชโูุง ู ูุงูุจโูุง ุณุณุชู
- `aiagent_usage`: ุขูุงุฑ ุงุณุชูุงุฏู ุฑูุฒุงูู
- ~~`aiagent_scheduled`~~: **ุญุฐู ุดุฏู** - ุฌุงฺฏุฒู ุจุง Action Scheduler

### ุงูุฏุงูุงุช ููุฌูุฏ:
| ุงูุฏุงู | ุงุฑุงุฆูโุฏููุฏู | ุชูุถุญุงุช |
|-------|------------|---------|
| `send_email` | WordPress `wp_mail` | ููุดู ุฏุฑ ุฏุณุชุฑุณ |
| `send_sms` | ููุชุฑ `aiagent_send_sms` | ูุงุฒ ุจู ูพุงุฏูโุณุงุฒ ููุชุฑ |
| `create_discount` | WooCommerce | ุงุฌุงุฏ ฺฉููพู ุชุฎูู |
| `update_product` | WooCommerce | ุจุฑูุฒุฑุณุงู ูุญุตูู |
| `schedule_followup` | Action Scheduler | ุฒูุงูโุจูุฏ ูพฺฏุฑ |
| `create_campaign` | wp_options | ุฐุฎุฑู ูพุดููุงุฏ ฺฉููพู |
| `create_bundle` | wp_options | ุฐุฎุฑู ูพุดููุงุฏ ุจุณุชู |
| `inventory_alert` | WooCommerce | ุชูุธู ุขุณุชุงูู ููุฌูุฏ |
| `loyalty_reward` | WooCommerce | ุงุฌุงุฏ ฺฉููพู ููุงุฏุงุฑ |
| `schedule_price_change` | Action Scheduler | ุฒูุงูโุจูุฏ ุชุบุฑ ููุช |
